
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../about/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Explanation - Academic Notes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#search-the-web-with-ai" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Academic Notes" class="md-header__button md-logo" aria-label="Academic Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Academic Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Explanation
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Explanation

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../contributing/" class="md-tabs__link">
        
  
    
  
  Contributing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Academic Notes" class="md-nav__button md-logo" aria-label="Academic Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Academic Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Explanation
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Explanation
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      1. Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-building-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      2. Building Blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Building Blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2a-first-steps" class="md-nav__link">
    <span class="md-ellipsis">
      2a. First steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-user-interface" class="md-nav__link">
    <span class="md-ellipsis">
      3. User Interface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-database-services" class="md-nav__link">
    <span class="md-ellipsis">
      4. Database Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Database Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4a-qdrant" class="md-nav__link">
    <span class="md-ellipsis">
      4a. Qdrant
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4b-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      4b. Postgres
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-api-services" class="md-nav__link">
    <span class="md-ellipsis">
      5. API Services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-usage" class="md-nav__link">
    <span class="md-ellipsis">
      6. Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#6a-usage-note" class="md-nav__link">
    <span class="md-ellipsis">
      6a. Usage note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6b-getting-praivatesearch-up-and-running" class="md-nav__link">
    <span class="md-ellipsis">
      6b. Getting PrAIvateSearch Up and Running
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      7. Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      1. Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-building-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      2. Building Blocks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Building Blocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2a-first-steps" class="md-nav__link">
    <span class="md-ellipsis">
      2a. First steps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-user-interface" class="md-nav__link">
    <span class="md-ellipsis">
      3. User Interface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-database-services" class="md-nav__link">
    <span class="md-ellipsis">
      4. Database Services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Database Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4a-qdrant" class="md-nav__link">
    <span class="md-ellipsis">
      4a. Qdrant
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4b-postgres" class="md-nav__link">
    <span class="md-ellipsis">
      4b. Postgres
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-api-services" class="md-nav__link">
    <span class="md-ellipsis">
      5. API Services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-usage" class="md-nav__link">
    <span class="md-ellipsis">
      6. Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#6a-usage-note" class="md-nav__link">
    <span class="md-ellipsis">
      6a. Usage note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6b-getting-praivatesearch-up-and-running" class="md-nav__link">
    <span class="md-ellipsis">
      6b. Getting PrAIvateSearch Up and Running
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      7. Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="search-the-web-with-ai">Search the Web with AI</h1>
<h2 id="1-introduction">1. Introduction</h2>
<div align="center">
    <img src="https://raw.githubusercontent.com/AstraBert/PrAIvateSearch/main/imgs/PrAIvateSearch_logo.png" alt="PrAIvateSearch logo">
</div>

<p>In <a href="https://huggingface.co/blog/as-cle-bert/build-an-ai-powered-search-engine-from-scratch">the last blog post</a> we introduced PrAIvateSearch <code>v1.0-beta.0</code>, a data-safe and private AI-powered search engine: despite being a fully functional solution, there were still hassles that made it under-perform, specifically:</p>
<ul>
<li>Content scraping from the URLs resulting from the web search was unreliable and sometimes did not produce correct results.</li>
<li>We extracted a series of key-words from web-based contents: keywords were then formatted into JSON and injected into the user prompt as context. This, despite being a viable solution to lighten the prompt, only gave the LLM a partial contextual information.</li>
<li>We used RAG for context augmentation, but it often proved inefficient as the retrieved context was passed directly into the user's prompt, making inference computationally intense and time-requiring.</li>
<li>Our interface was basic and essential, lacking the dynamic and modern flows of other web applications.</li>
<li>The use of Google Search API to search the web was not optimal under a privacy-wise point of view</li>
</ul>
<p>In this sense, we decided to apply a way simpler and direct workflow, synthesized in the following image:  </p>
<p><img alt="PrAIvateSearch workflow" src="https://raw.githubusercontent.com/AstraBert/PrAIvateSearch/main/imgs/PrAIvateSearch_Flowchart.png" /></p>
<h2 id="2-building-blocks">2. Building Blocks</h2>
<p>The application is made up by three important building blocks:</p>
<ul>
<li>A dynamic, chat-like <strong>user interface</strong> built with <a href="https://nextjs.org/">NextJS</a>  (launched via <em>docker compose</em>)</li>
<li>Third-party local database services: <strong>Postgres</strong> and <strong>Qdrant</strong> (launched via <em>docker compose</em>)</li>
<li>An API service, which is built with <a href="https://fastapi.tiangolo.com/">FastAPI</a> and served with <a href="https://www.uvicorn.org/">Uvicorn</a>  (launched in an isolated <em>conda environment</em>): this service is responsible for <strong>connecting the frontend with the backend</strong> third party services, web search and all the functions related to finding an answer to the user's query.</li>
</ul>
<p>We'll go through all these building blocks, but first let's have a look on what are the pre-requirements and the first steps to get the code to build PrAIvateSearch <code>v2.0-beta.0</code>.</p>
<h3 id="2a-first-steps">2a. First steps</h3>
<p>To get the necessary code and build the environment to run it, you will need:</p>
<ul>
<li><a href="https://git-scm.com/docs"><code>git</code> toolset</a> to get the code from the <a href="https://github.com/AstraBert/PrAIvateSearch">GitHub repository</a></li>
<li><a href="https://docs.conda.io/projects/conda/en/latest/user-guide/getting-started.html"><code>conda</code></a> package manager to build the environment from which the API will be launched</li>
<li><a href="https://www.docker.com/"><code>docker</code></a> and <a href="https://docs.docker.com/compose/"><code>docker compose</code></a> to serve the UI and the third-party local databases.</li>
</ul>
<p>Now, to get the code, you can simply run:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/AstraBert/PrAIvateSearch.git
<span class="nb">cd</span><span class="w"> </span>PrAIvateSearch
</code></pre></div>
<p>First of all move <code>.env.example</code> to <code>.env</code>...</p>
<div class="highlight"><pre><span></span><code>mv<span class="w"> </span>.env.example<span class="w"> </span>.env
</code></pre></div>
<p>...and specify PostgreSQL related variables:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># .env file</span>
<span class="nv">pgql_db</span><span class="o">=</span><span class="s2">&quot;postgres&quot;</span>
<span class="nv">pgql_user</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span>
<span class="nv">pgql_psw</span><span class="o">=</span><span class="s2">&quot;</span>
</code></pre></div>
<p>You will then need to build the API environment with:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># create the environment</span>
conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>conda_environment.yaml

<span class="c1"># activate the environment</span>
conda<span class="w"> </span>activate<span class="w"> </span>praivatesearch

<span class="c1"># run crawl4ai post-installation setup</span>
crawl4ai-setup

<span class="c1"># run crawl4ai health checks</span>
crawl4ai-doctor

<span class="c1"># deactivate the environment</span>
conda<span class="w"> </span>deactivate
</code></pre></div>
<p>And, finally, you will be able to launch the frontend and the databases with:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># The use of the -d option is not mandatory</span>
docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span><span class="o">[</span>-d<span class="o">]</span>
</code></pre></div>
<h2 id="3-user-interface">3. User Interface</h2>
<p>The user interface is now based on a NextJS implementation of a modern, dynamic chat interface. The interface is <strong>inspired to ChatGPT</strong>, and aims at giving the user a similar experience to that of using OpenAI's product.</p>
<p>Whenever the user interacts with the UI by sending a message, the NextJS app backend sends a <code>GET</code> request to <code>http://localhost:8000/messages/</code>, where our FastAPI/Uvicorn managed API runs (see <a href="#5-api-services">below</a>). Once the request is fulfilled, the applications displays the message it got back, which is the answer to the user's query.</p>
<p>The NextJS application runs on <code>http://localhost:3000</code> and is launched through <em>docker compose</em>.</p>
<h2 id="4-database-services">4. Database Services</h2>
<p>Database services are run locally thanks to <em>docker compose</em>: they are completely user-managed and can be easily monitored. This gives the user complete control over the data flow inside the application.</p>
<h3 id="4a-qdrant">4a. Qdrant</h3>
<p><a href="https://qdrant.tech">Qdrant</a> is a vector database service that plays a core role inside PrAIvateSearch. Thanks to Qdrant, we:  </p>
<ul>
<li>Create and manage a <em>semantic cache</em>, in which we store questions that the user already asked and answers that the LLM gave to them, so that we can use the same answer if the user inputs the same question or a similar one. We use semantic search to find similar questions and use a cut-off threshold of 75% similarity to filter out non-relevant hits: that's why our cache is not just a cache, but it is also <em>semantic</em>.</li>
<li>Store the content scraped from the web during the web searching and crawling step: we use a sparse collection for this purpose. We then perform sparse retrieval with <a href="https://huggingface.co/prithivida/Splade_PP_en_v1">Splade</a>, loaded with <a href="https://qdrant.github.io/fastembed/">FastEmbed</a> (a python library managed by Qdrant itself): this first retrieval step yields the 5 top hits for the user's prompt inside the database of contents scraped from the web.</li>
</ul>
<p>Qdrant is accessible for monitoring, thanks to a complete and easy-to-use interface, on <code>http://localhost:6333/dashboard</code></p>
<h3 id="4b-postgres">4b. Postgres</h3>
<p><a href="https://www.postgresql.org/">Postgres</a> is a relational database, and it is employed here essentially as a manager for chat memory.  </p>
<p>Thanks to a <a href="https://www.sqlalchemy.org/">SQLAlchemy</a>-based custom client, we can load all the messages sent during the conversation in the <code>messages</code> table: this table is structured in such a way that it is compatible with the chat template that we set for our LLM, and so the retrieval of the chat history at inference time already provides the language model with the full number of previously sent messages.</p>
<p>Postgres can be easily monitored through <a href="https://www.adminer.org/">Adminer</a>, a simple and intuitive database management tool: you just need to provide the database type (PostgreSQL), the database name, the username and the password (variables that are passed to Docker and that you can define inside <a href="https://github.com/AstraBert/PrAIvateSearch/blob/main/.env.example">your <code>.env</code> file</a>) . Also Adminer runs locally and is served through <em>docker compose</em>: it is accessible at <code>http://localhost:8080</code>.</p>
<h2 id="5-api-services">5. API Services</h2>
<p>As we said, we built a local API service thanks to FastAPI and Uvicorn, two intuitive and easy-to-use tools that make API development seamless.</p>
<p>The API endpoint is up at <code>http://localhost:8000/messages/</code> and receives the user messages from the NextJS application. The workflow from receiving a message to returning a response is straightforward:</p>
<ol>
<li>We check if the user's prompt corresponds to an already asked question thanks to the <em>semantic cache</em>: this cache is basically a dense Qdrant collection, with 768-dimensional vectors produced by <a href="https://huggingface.co/sentence-transformers/LaBSE">LaBSE</a>. If there is a significant match within the semantic cache, we return the same answer used for that match, otherwise we proceed with handling the request</li>
<li>If the user's query did not yield a significant match from the <em>semantic cache</em>, we proceed to extracting keywords from the user's natural language prompt with the <a href="https://pypi.org/project/rake-nltk/">RAKE</a> (Rapid Automatic Keyword Extraction) algorithm. These keywords will be used to search the web</li>
<li>We search the web through <a href="https://pypi.org/project/duckduckgo-search/">DuckDuckGo Search API</a>: using DuckDuckGo ensures more privacy in surfing the net than exploiting Google. This is part of the effort that PrAIvateSearch makes to ensure that the user's data are safe and not indexed by Big Techs for secondary (not-always-so-transparent) purposes.</li>
<li>We scrape content using the URLs returned by the web search: to do this, we use <a href="https://github.com/unclecode/crawl4ai">Crawl4AI</a> asynchronous web crawler, and we return all the scraped content in markdown format</li>
<li>We split the markdown texts from the previous step with <a href="https://python.langchain.com/api_reference/text_splitters/markdown/langchain_text_splitters.markdown.MarkdownTextSplitter.html">LangChain <code>MarkdownTextSplitter</code></a>: after this step, we will have 1000-charachters long text chunks</li>
<li>The chunks are encoded into sparse vectors with Splade and uploaded to a Qdrant sparse collection</li>
<li>We  search the sparse collection with the user's original query and retrieve the top 5 most relevant documents</li>
<li>These 5 relevant documents are then re-ranked: we employ LaBSE to encode the relevant documents into dense vectors and we evaluate their cosine similarity with the vectorized user's prompt. The most similar document gets retrieved as a context</li>
<li>The context is passed as a user's message, and the prompt is passed right after it as a user's message too. In this sense, the LLM only has to reply to the user's prompt, but can access, through chat memory, the web-based context for it</li>
<li><a href="https://huggingface.co/Qwen/Qwen2.5-1.5B-Instruct">Qwen-2.5-1.5B-Instruct</a> performs inference on the user's prompt and generates an answer to it: this answer is then returned as the API final response, and will be displayed in the UI.</li>
</ol>
<h2 id="6-usage">6. Usage</h2>
<h3 id="6a-usage-note">6a. Usage note</h3>
<blockquote>
<p><em>The NextJS application was successfully developed and tested on a Ubuntu 22.04.3 machine, with 32GB RAM, 22 cores CPU and Nvidia GEFORCE RTX4050 GPU (6GB, cuda version 12.3), python version 3.11.11 (packaged by conda 24.11.0)</em></p>
</blockquote>
<p>Although being at a good stage of development, the application is a <code>beta</code> and might still contain bugs and have OS/hardware/python version incompatibilities.</p>
<h3 id="6b-getting-praivatesearch-up-and-running">6b. Getting PrAIvateSearch Up and Running</h3>
<blockquote>
<p><em>To get PrAIvateSearch up and running you need to have already executed <a href="#2a-first-steps">the first steps</a></em></p>
</blockquote>
<p>Once we have launched (from within the <a href="https://github.com/AstraBert/PrAIvateSearch">PrAIVateSearch folder</a>) the databases backend services and the frontend applications via <em>docker compose</em> with this command :</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>compose<span class="w"> </span>up
</code></pre></div>
<p>We can head over to the <em>conda</em> environment we set up in the first steps, and launch the API:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># activate the environment</span>
conda<span class="w"> </span>activate<span class="w"> </span>praivatesearch

<span class="c1"># launch the application</span>
uvicorn<span class="w"> </span>main:app<span class="w"> </span>--host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="w"> </span><span class="m">8000</span>
</code></pre></div>
<p>After loading the several AI models involved in the development of the application, you will see that the API is up and ready to receive requests.</p>
<p>If you want to test the API prior to sending requests through the frontend, you can simply use this <code>curl</code> command:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span><span class="s2">&quot;http://0.0.0.0:8000/messages/What%20is%20the%20capital%20of%20France&quot;</span>
</code></pre></div>
<p>If everything went smoothly, you should receive a response like this:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;response&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The capital of France is **Paris**.&quot;</span><span class="p">}</span>
</code></pre></div>
<p>And that's all! Now head over to <code>http://localhost:3000</code> and start playing around with PrAIvateSearch!🪿</p>
<h2 id="7-conclusion">7. Conclusion</h2>
<p>The aim behind PrAIvateSearch is to provide an open-source, private and data-safe alternative to Big Tech solutions. The application is still a beta, so, although its workflow may seem solid, there may still be hiccups, untackled errors and imprecisions. If you want to contribute to the project, report issues and help developing the OSS AI community and environment, feel free to do so on <a href="https://github.com/AstraBert/PrAIvateSearch">GitHub</a> and to help it with <a href="https://github.com/sponsors/AstraBert">funding</a>.</p>
<p>Thanks!🤗</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>